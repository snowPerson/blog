function changeTime(a){var b=new Date(a),c=b.getFullYear()+"-"+addZero(b.getMonth()+1)+"-"+addZero(b.getDate())+" ";return c+=addZero(b.getHours())+":"+addZero(b.getMinutes())+":"+addZero(b.getSeconds())}function addZero(a){return 10>a?"0"+a:""+a}function makePaging(a,b){var c=[],d=function(a,d){for(var e=a;d>e;e++){var f,g=!1;e+1==b&&(g=!0),f={text:e+1,page:e+1,active:g},c.push(f)}};return 5>=a?d(0,a):(1!=b&&(c.push({text:"首页",page:1,active:!1}),c.push({text:"上一页",page:b-1,active:!1})),3>b?d(0,5):b>a-2?d(a-5,a):(c.push({text:b-2,page:b-2,active:!1}),c.push({text:b-1,page:b-1,active:!1}),c.push({text:b,page:b,active:!0}),c.push({text:b+1,page:b+1,active:!1}),c.push({text:b+2,page:b+2,active:!1})),b!=a&&(c.push({text:"下一页",page:b+1,active:!1}),c.push({text:"尾页",page:a,active:!1}))),c}function Canvas(a,b,c){this.ctx=a,this.clientW=b,this.clientH=c}function getMinSection(a){var b=a.length;arr=[];for(var c=0;b>c;c++){var d={};d.index=c,d.height=a.eq(c)[0].offsetHeight,arr.push(d)}return arr.sort(function(a,b){return a.height-b.height}),arr[0].index}function randomNum(a,b){var c=Math.min(a,b),d=Math.max(a,b);return Math.random()*(d-c)+c}var service=angular.module("myService",[]);service.factory("ysAnimate",function(){return{tween:{linear:function(a,b,c,d){return c*a/d+b},easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeBoth:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInStrong:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutStrong:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeBothStrong:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},elasticIn:function(a,b,c,d,e,f){var g;return 0===a?b:1==(a/=d)?b+c:(f||(f=.4*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f))+b)},elasticOut:function(a,b,c,d,e,f){var g;return 0===a?b:1==(a/=d)?b+c:(f||(f=.4*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)},elasticBoth:function(a,b,c,d,e,f){var g;return 0===a?b:2==(a/=d/2)?b+c:(f||(f=.3*d*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)*.5+c+b)},backIn:function(a,b,c,d,e){return"undefined"==typeof e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b},backOut:function(a,b,c,d,e){return"undefined"==typeof e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},backBoth:function(a,b,c,d,e){return"undefined"==typeof e&&(e=1.70158),(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},bounceIn:function(a,b,c,d){return c-this.bounceOut(d-a,0,c,d)+b},bounceOut:function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},bounceBoth:function(a,b,c,d){return d/2>a?.5*this.bounceIn(2*a,0,c,d)+b:.5*this.bounceOut(2*a-d,0,c,d)+.5*c+b}},move:function(a,b){var c=b.target,d=b.time||400,e=b.fx||"linear",f=b.fn||null,g=a,h=this,i=!0;window.requestAnimationFrame&&(i=!1);var j={};for(var k in c){var l=parseInt(g.css(k));if(!angular.isNumber(l)||isNaN(l))if("left"==k)l=g[0].offsetLeft;else if("top"==k)l=g[0].offsetTop;else{if("opacity"!=k)return console.log(g.css(k)+"|"+k),void console.log("元素的 "+k+" 值不合法，请先设置元素的 "+k+" 值!");l=parseInt(10*getComputedStyle(g[0],null).opacity)/10}j[k]=l}var m=(new Date).getTime(),n=function(){var a=(new Date).getTime(),b=d-Math.max(0,m-a+d);for(var k in c){var l=h.tween[e](b,j[k],c[k]-j[k],d);"opacity"==k?g.css(k,l):g.css(k,l+"px")}b!=d?i?g.prop("animateTimer",setTimeout(n,16.7)):g.prop("animateTimer",requestAnimationFrame(n)):f&&f()};i?clearTimeout(g.prop("animateTimer")):cancelAnimationFrame(g.prop("animateTimer")),n()},transform:function(a,b){var c=b.target,d=b.time||400,e=b.fx||"linear",f=b.fn||null,g=a,h=this,i=!0;window.requestAnimationFrame&&(i=!1);var j=g.css("-webkit-transform")||g.css("-moz-transform")||g.css("-ms-transform")||g.css("-o-transform")||g.css("transform"),k=g.css("-webkit-transform-origin")||g.css("-moz-transform-origin")||g.css("-ms-transform-origin")||g.css("-o-transform-origin")||g.css("transform-origin"),l={rotate:0,translate:[0,0],scale:[1,1],skew:[0,0],origin:["50%","50%"]};if(k){var m=k.split(" ");l.origin=[m[0],m[1]]}if(j)for(var n=j.split(") "),o=n.length,p=0;o>p;p++){var q,r=n[p].split("("),s=r[0];if("rotate"==s)q=parseFloat(r[1]);else{var t=r[1].split(",");q=[parseFloat(t[0]),parseFloat(t[1])]}l[s]=q}angular.forEach(l,function(a,b){c[b]||0===c[b]||(c[b]=l[b])}),l.origin=c.origin||["50%","50%"];var u=l.origin[0]+" "+l.origin[1],v=(new Date).getTime(),w=function(){var a,b,j=(new Date).getTime(),k=d-Math.max(0,v-j+d),m=[],n=h.tween[e](k,l.rotate,c.rotate-l.rotate,d);m.push("rotate("+n+"deg)"),a=h.tween[e](k,l.translate[0],c.translate[0]-l.translate[0],d),b=h.tween[e](k,l.translate[1],c.translate[1]-l.translate[1],d),m.push("translate("+a+"px,"+b+"px)"),a=h.tween[e](k,l.scale[0],c.scale[0]-l.scale[0],d),b=h.tween[e](k,l.scale[1],c.scale[1]-l.scale[1],d),m.push("scale("+a+","+b+")"),a=h.tween[e](k,l.skew[0],c.skew[0]-l.skew[0],d),b=h.tween[e](k,l.skew[1],c.skew[1]-l.skew[1],d),m.push("skew("+a+"deg,"+b+"deg)"),m=m.join(" "),g.css({"-webkit-transform":m,"-moz-transform":m,"-ms-transform":m,"-o-transform":m,transform:m}),g.css({"-webkit-transform-origin":u,"-moz-transform-origin":u,"-ms-transform-origin":u,"-o-transform-origin":u,"transform-origin":u}),k!=d?i?g.prop("transormTimer",setTimeout(w,16.7)):g.prop("transormTimer",requestAnimationFrame(w)):f&&f()};i?clearTimeout(g.prop("transormTimer")):cancelAnimationFrame(g.prop("transormTimer")),w()}}}),service.factory("ysHttp",["$rootScope","$http",function(a,b){return{before:function(){a.loadingBo=!0},after:function(){a.loadingBo=!1},get:function(a,c){var d=this;d.before(),b.get(a).success(function(a){d.success(a,c)}).error(function(a){d.error(a)})},post:function(a,c,d){var e=this;e.before(),b.post(a,c).success(function(a){e.success(a,d)}).error(function(a){e.error(a)})},success:function(b,c){return this.after(),"ok"==b.type?c(b):void(/read/.test(b.info)?(a.dialogShow=!0,a.dialogMsg="服务端读取数据失败<br>请稍后再行尝试！"):/save/.test(b.info)?(a.dialogShow=!0,a.dialogMsg="服务端存储数据失败<br>请稍后再行尝试！"):(a.dialogShow=!0,a.dialogMsg="服务器错误："+b.info))},error:function(b){this.after(),a.dialogShow=!0,a.dialogMsg="与服务器通信失败，请稍后再行尝试<br>或者您也可以直接联系管理员，谢谢！"}}}]);var filter=angular.module("myFilter",[]);filter.filter("to_trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),filter.filter("initTime",function(){return function(a){return changeTime(a)}});var ctrl=angular.module("myController",[]);ctrl.controller("myCtrl",["$scope","$rootScope","$timeout","$location","ysHttp",function(a,b,c,d,e){var f=!0,g=null;a.toggle=function(a,e){var h=d.path(),i=h.split("/"),j=i[i.length-1];-1!=h.indexOf("note/")&&(j=i[i.length-2]),f&&a!=j&&(f=!1,b.pagename=a,e&&(b.articleID=e),c.cancel(g),g=c(function(){f=!0},1600))},a.loginBo=!1,a.dialogBo=!1;var h=localStorage.getItem("info"),i="",j="";h&&(h=angular.fromJson(h),i=h.name,j=h.qq),a.msg={nk:i,qq:j,dialog:"",url:"",info:{msg:"",from:"",to:"",id:""}},a.watchData={msg:0,article:0},a.fn={hideLogin:function(){a.loginBo=!1},showLogin:function(){a.loginBo=!0},showDialog:function(b){a.msg.dialog=b,a.dialogBo=!0},confirm:function(b){if(!b){if(!a.msg.nk)return void this.showDialog("亲，至少留个昵称呗 ^_^");if(this.checkLen(a.msg.nk))return a.msg.nk="",void this.showDialog("亲，昵称太长了哦，中文最多6位，英文最多12位。<br>咱昵称就改短点呗 ^_^");var c={name:a.msg.nk,qq:a.msg.qq};localStorage.setItem("info",angular.toJson(c))}var d={from:a.msg.nk,qq:a.msg.qq,msg:a.msg.info.msg,to:a.msg.info.to,id:a.msg.info.id};e.post(a.msg.url,d,function(c){a.msg.info.msg="",a.msg.info.from="",a.msg.info.to="",a.msg.info.id="",/message/g.test(a.msg.url)?a.watchData.msg++:/article/g.test(a.msg.url)&&a.watchData.article++,b||a.fn.hideLogin()})},checkLen:function(a){for(var b=0,c=0;c<a.length;c++)b+=null!==a[c].match(/[^\x00-\xff]/gi)?2:1;return b>12?!0:!1}},a.$on("$locationChangeSuccess",function(a,c,d){var e=c.split("/"),f=e[e.length-1];-1!=c.indexOf("note/")&&(f=e[e.length-2]),b.pagename=c,b.oldPage=c}),a.$watch("dialogShow",function(c){c&&(a.fn.showDialog(b.dialogMsg),a.dialogShow=!1)})}]),ctrl.controller("ctrl-note-list",["$scope","$rootScope","ysHttp",function(a,b,c){a.startBo=!1,a.data={},a.data.type="all",a.data.category=[],a.data.article={},a.data.category.push({_id:"all",name:"全部",active:!0});var d=0;a.getCategory=function(){c.get("/article/category",function(b){d++,2==d&&(a.startBo=!0),b=b.data;for(var c=b.length,e=0,f=0;c>f;f++)b[f].artive=!1,e+=parseInt(b[f].length),a.data.category.push(b[f]);a.data.category[0].length=e})},a.getArticle=function(b,e,f){b=parseInt(b);var g=9*(b-1),h="/article/list?start="+g+"&type="+a.data.type;document.documentElement.scrollTop=document.body.scrollTop=0,c.get(h,function(c){d++,2==d&&(a.startBo=!0);var g=Math.ceil(parseInt(c.length)/9);a.data.curPage=b,a.data.paging=makePaging(g,b);for(var h=[],i=c.data.length,j=0;i>j;j++)h.push(c.data[j]);a.data.list=h,e&&(a.data.opacitBo=!1),f&&f()})},a.getCategory(),a.getArticle(1),a.data.opacitBo=!1,a.fnpaging=function(b){b=parseInt(b),b!=a.data.curPage&&(a.data.opacitBo=!0,setTimeout(function(){a.getArticle(b,!0)},400))},a.tagFilter=function(b){b._id!=a.data.type&&(a.data.type=b._id,a.data.opacitBo=!0,setTimeout(function(){a.getArticle(1,!0,function(){for(var b=a.data.category.length,c=0;b>c;c++)a.data.category[c].active=!1,a.data.category[c]._id==a.data.type&&(a.data.category[c].active=!0)})},400))}}]),ctrl.controller("ctrl-note",["$scope","$rootScope","$stateParams","ysHttp",function(a,b,c,d){a.data={},a.startBo=!1,a.data.id=c.id,a.msg.url="/article/comment/save/"+a.data.id,a.msg.info.msg="",a.data.autoFocus=!1,a.data.texareaT=0;var e=0;a.getArticle=function(){d.get("/article/"+a.data.id,function(b){e++,2===e&&(a.startBo=!0),a.data.article=b.data})},a.getReply=function(){d.get("/article/comment/"+a.data.id,function(b){e++,2===e&&(a.startBo=!0),a.data.reply=b.data})},a.getReply(),a.getArticle(),a.subMsg=function(){return a.msg.info.msg?void(a.msg.nk?a.fn.confirm(!0):a.fn.showLogin()):a.fn.showDialog("亲，至少输入点啥呗！")},a.fnComment=function(b,c){var d=document.documentElement.scrollTop||document.body.scrollTop;d>a.data.texareaT&&(document.documentElement.scrollTop=document.body.scrollTop=a.data.texareaT),a.data.autoFocus=!0,a.msg.info.to=b,a.msg.info.id=c},a.fnBlur=function(){a.data.autoFocus=!1},a.hideBtn=function(){a.msg.info.to="",a.msg.info.id=""},a.$watch("watchData.article",function(b){b&&a.getReply()})}]),ctrl.controller("ctrl-demo",["$scope","$rootScope","ysHttp",function(a,b,c){a.startBo=!1,a.data={},a.data.nowLen=0,a.data.httpBo=!0,a.fnHttp=function(b){var d="/demo/list?start="+b;c.get(d,function(b){a.startBo=!0,a.data.length=b.length,a.data.demos=b.data,a.data.nowLen+=b.data.length,a.data.httpBo=!0})},a.fnHttp(0)}]),ctrl.controller("ctrl-message",["$scope","$rootScope","ysHttp",function(a,b,c){a.startBo=!0,a.msg.url="/message/save",a.msg.info.msg="",a.data={},a.data.msgs=[],a.ctrlOpenUlBo=!1,a.replyPageNum=1,a.getMsg=function(b,d){b=parseInt(b);var e=6*(b-1);c.get("/message/list?start="+e,function(b){a.startBo=!0,a.data.len=b.length,a.data.msgs=b.msgs;var c=Math.ceil(b.length/6),f=e/6+1;a.data.currentPage=f,a.data.paging=makePaging(c,f),d&&(a.ctrlOpenUlBo=!0)})},a.getMsg(1),a.autoFocus=!0,a.comment=function(b,c){document.documentElement.scrollTop=document.body.scrollTop=0,a.autoFocus=!0,a.msg.info.to=b,a.msg.info.id=c},a.fnBlur=function(){a.autoFocus=!1},a.hideBtn=function(){a.msg.info.to="",a.msg.info.id=""},a.subMsg=function(){return a.msg.info.msg?void(a.msg.nk?(a.msg.info.id||(a.replyPageNum=1),a.fn.confirm(!0)):a.fn.showLogin()):a.fn.showDialog("亲，至少输入点啥呗！")},a.fnPaging=function(b){b=parseInt(b),b!=a.data.currentPage&&(a.replyPageNum=b,a.ctrlHeightBo=!0)},a.ctrlHeightBo=!1,a.$watch("watchData.msg",function(b){b&&(a.ctrlHeightBo=!0)})}]),ctrl.controller("ctrl-about",["$scope","$rootScope","$timeout",function(a,b,c){a.startBo=!0}]),Canvas.prototype={constructor:Canvas,bgdsArr:[[105,206,250],[126,253,216],[195,126,253],[253,198,126],[254,150,182]],bords:[],bgds:[105,206,250],origBgds:[105,206,250],bgdCount:0,animateCount:0,bgdNum:0,bo:!0,randomBo:!0,init:function(){var a=0,b=this;requestAnimationFrame||(this.bo=!1),this.initFn();var c=function(){a++,23>=a&&(b.addBords(),setTimeout(c,150))};c()},initFn:function(){this.drawCanvas();var a=this;return this.bo?void requestAnimationFrame(function(){a.initFn.call(a)}):setTimeout(function(){a.initFn.call(a)},16.7)},drawCanvas:function(){this.ctx.clearRect(0,0,this.clientW,this.clientH);var a,b=this.bords.length;for(this.drawBgd(),a=0;b>a;a++){var c=this.bords[a].r,d=this.bords[a].x,e=this.bords[a].y;this.bords[a].type;this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(d,e,c,0,2*Math.PI),this.ctx.closePath();var f=this.ctx.createRadialGradient(d,e,0,d,e,1.8*c);f.addColorStop(0,this.bords[a].c1),f.addColorStop(1,this.bords[a].c2),this.ctx.fillStyle=f,this.ctx.fill(),this.ctx.restore()}this.updateBords()},changeBgd:function(){var a,b,c=60;this.animateCount++,this.randomBo&&(this.bgdNum++,this.bgdNum%=this.bgdsArr.length);for(var d=0;3>d;d++)a=this.bgdsArr[this.bgdNum][d],b=(a-this.origBgds[d])/c,this.bgds[d]=Math.round(this.bgds[d]+b);if(this.animateCount===c)for(this.bgdCount=0,this.randomBo=!0,this.animateCount=0,d=0;3>d;d++)this.origBgds[d]=this.bgdsArr[this.bgdNum][d]},drawBgd:function(){this.bgdCount++,changeBgdTime=1200,this.bgdCount>=changeBgdTime&&(this.bgdCount!==changeBgdTime&&(this.randomBo=!1),this.changeBgd());var a=this.clientW/2;this.ctx.save();var b=this.ctx.createRadialGradient(a,this.clientH,0,a,this.clientH,.7*this.clientW);b.addColorStop(0,"rgb("+this.bgds[0]+","+this.bgds[1]+","+this.bgds[2]+")"),b.addColorStop(1,"black"),this.ctx.fillStyle=b,this.ctx.fillRect(0,0,this.clientW,this.clientH),this.ctx.restore()},addBords:function(){var a,b,c,d,e={};e.r=30*Math.random()+50,e.x=-e.r,e.y=this.clientH+e.r,e.vx=30*Math.random()+10,e.vy=-(30*Math.random()+10),a=Math.floor(randomNum(165,255)),b=Math.floor(randomNum(165,255)),c=Math.floor(randomNum(165,255)),d=randomNum(.5,.7),e.c1="rgba("+a+","+b+","+c+","+d+")",a=Math.floor(randomNum(50,150)),b=Math.floor(randomNum(50,150)),c=Math.floor(randomNum(50,150)),d=randomNum(.5,.7),e.c2="rgba("+a+","+b+","+c+","+d+")",e.decay=parseInt(randomNum(100,120)),e.sx=parseInt(100*randomNum(.97,.98))/100,e.sy=parseInt(100*randomNum(.97,.98))/100,this.bords.push(e)},updateBords:function(){var a,b=this.bords.length;for(a=0;b>a;a++)this.bords[a].decay--,this.bords[a].x+=this.bords[a].vx,this.bords[a].y+=this.bords[a].vy,this.bords[a].decay>0&&(this.bords[a].vx*=this.bords[a].sx,this.bords[a].vy*=this.bords[a].sy),this.bords[a].x<this.bords[a].r?(this.bords[a].x=this.bords[a].r,this.bords[a].vx=-this.bords[a].vx):this.bords[a].x>this.clientW-this.bords[a].r&&(this.bords[a].x=this.clientW-this.bords[a].r,this.bords[a].vx=-this.bords[a].vx),this.bords[a].y<this.bords[a].r?(this.bords[a].y=this.bords[a].r,this.bords[a].vy=-this.bords[a].vy):this.bords[a].y>this.clientH-this.bords[a].r&&(this.bords[a].y=this.clientH-this.bords[a].r,this.bords[a].vy=-this.bords[a].vy)}};var direc=angular.module("myDirective",[]);direc.directive("delay",["ysAnimate",function(a){return{link:function(b,c,d){var e=CLIENT_W,f=CLIENT_H+10,g=document.getElementById("canvas");g.width=e,g.height=f;var h=g.getContext("2d"),i=new Canvas(h,e,f);i.drawBgd();var j={target:{opacity:1},time:400,fn:function(){i.init.call(i)}};a.move(c,j)}}}]),direc.directive("index",["$timeout","$state","$rootScope","ysAnimate",function(a,b,c,d){return{link:function(e,f,g){f.css("height",CLIENT_H-50+"px");for(var h=f.find("section"),i=h.length,j=[[-600,-500],[600,-400],[600,500],[-700,400]],k=0;i>k;k++)angular.element(h[k]).css({"-webkit-transform":"translate("+j[k][0]+"px, "+j[k][1]+"px)","-moz-transform":"translate("+j[k][0]+"px, "+j[k][1]+"px)","-ms-transform":"translate("+j[k][0]+"px, "+j[k][1]+"px)","-o-transform":"translate("+j[k][0]+"px, "+j[k][1]+"px)",transform:"translate("+j[k][0]+"px, "+j[k][1]+"px)",opacity:0});var l=document.getElementById("nav");angular.element(l).css("opacity",0),a(function(){for(document.documentElement.scrollTop=document.body.scrollTop=0,k=0;i>k;k++)d.transform(angular.element(h[k]),{target:{translate:[0,0]},time:800,fx:"easeOutStrong"}),d.move(angular.element(h[k]),{target:{opacity:1},time:800});c.time=10},c.time),e.$watch("pagename",function(a,e,f){if(a!=c.oldPage){var g=function(){c.oldPage=a,b.go(a)};for(k=0;i>k;k++)d.transform(angular.element(h[k]),{target:{translate:j[k]},time:1500,fx:"easeOutStrong"}),k==i-1?d.move(angular.element(h[k]),{target:{opacity:0},time:800,fn:g}):d.move(angular.element(h[k]),{target:{opacity:0},time:800})}})}}}]),direc.directive("page",["$timeout","$state","$rootScope","ysAnimate",function(a,b,c,d){return{link:function(e,f,g){var h=400,i=f.next("div");f.css({"-webkit-transform":"translate("+-h+"px, 0px)","-moz-transform":"translate("+-h+"px, 0px)","-ms-transform":"translate("+-h+"px, 0px)","-o-transform":"translate("+-h+"px, 0px)",transform:"translate("+-h+"px, 0px)",opacity:0});var j=document.getElementById("nav");angular.element(j).css("opacity",1),e.$watch("pagename",function(e,g,j){e!=c.oldPage&&(d.transform(f,{target:{translate:[h,0]},time:700,fx:"easeOutStrong"}),d.move(f,{target:{opacity:0},time:500}),i.length&&(d.transform(i,{target:{translate:[0,-300]},time:700,fx:"easeOutStrong"}),d.move(i,{target:{opacity:0},time:700})),a(function(){c.oldPage=e,/^note$/.test(e)?b.go(e,{id:c.articleID}):b.go(e)},700))}),e.$watch("startBo",function(b,e,g){b&&a(function(){if(document.documentElement.scrollTop=document.body.scrollTop=0,d.transform(f,{target:{translate:[0,0]},time:800,fx:"backOut"}),d.move(f,{target:{opacity:1},time:800}),c.time=10,i.length){var a=1,b=f[0].offsetLeft-5-i[0].offsetWidth;0>b&&(a=0),i.css({left:b+"px",opacity:0,"-webkit-transform":"translate(0px, -300px)","-moz-transform":"translate(0px, -300px)","-ms-transform":"translate(0px, -300px)","-o-transform":"translate(0px, -300px)",transform:"translate(0px, -300px)"}),d.transform(i,{target:{translate:[0,0]},time:800,fx:"backOut"}),d.move(i,{target:{opacity:a},time:800})}},c.time)})}}}]),direc.directive("nav",["$rootScope",function(a){return{link:function(b,c,d){var e=c.find("li"),f=function(a){for(var b=0;b<e.length;b++)angular.element(e[b]).removeClass("active");"/"==a||"index"==a||""===a?angular.element(e[0]).addClass("active"):/note/g.test(a)?angular.element(e[1]).addClass("active"):"demo"==a?angular.element(e[2]).addClass("active"):"message"==a?angular.element(e[3]).addClass("active"):"about"==a&&angular.element(e[4]).addClass("active")};f(a.pagename),a.$on("$locationChangeStart",function(a,b){var c=b.split("/"),d=c[c.length-1]||"index";-1!=b.indexOf("note/")&&(d=c[c.length-2]),f(d)})}}}]),direc.directive("loading",["$interval","ysAnimate",function(a,b){return{link:function(c,d,e){var f=d.find("div");d.css({opacity:0,top:(CLIENT_H-240)/2+"px"});var g;c.$watch("loadingBo",function(a,b,c){if(a!=b){if(a)return h.show();h.hide()}});var h={show:function(){d.css("display","block"),b.move(d,{target:{opacity:1},time:300}),this.run()},hide:function(){b.move(d,{target:{opacity:0},time:500,fn:function(){d.css("display","none"),a.cancel(g)}})},run:function(){var c=1600,d=function(){f.css({"-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)","-o-transform":"rotate(0deg)",transform:"rotate(0deg)"}),b.transform(f,{target:{rotate:360},time:c,fx:"easeBothStrong"})};d(),g=a(d,c)}}}}}]),direc.directive("noteTags",["$window",function(a){return{link:function(b,c,d){angular.element(a).bind("scroll",function(){var a=this.document.body.scrollTop||this.document.documentElement.scrollTop;a>20?c.addClass("tag-fix"):c.removeClass("tag-fix")})}}}]),direc.directive("setHeight",function(){return{link:function(a,b,c){b.css("minHeight",CLIENT_H+"px")}}}),direc.directive("pubuliu",["$timeout","$window","ysAnimate","ysHttp",function(a,b,c,d){return{link:function(d,e,f){var g,h=e.find("section"),i=h.eq(0)[0].offsetWidth,j=i/400,k=!0,l=function(){var b=d.data.demos,f=(b.length,10);angular.forEach(b,function(b,d){f+=100;var e=b.height*j,g=angular.element('<div class="box">'),i='<a href="'+b.path+'" target="_blank"><div class="time">'+b.time+'</div><img src="'+b.path+'/photo.jpg" style="height:'+e+'px"><div class="text"><h3>'+b.title+"</h3><p>"+b.desc+"</p></div></a>";g.html(i),g.css("opacity",0),h.eq(getMinSection(h)).append(g),a(function(){c.move(g,{target:{opacity:1},time:400})},f)}),g=e[0].offsetHeight,k&&(k=!1,m())},m=function(){angular.element(b).bind("scroll",function(){var a=this.document.body.scrollTop||this.document.documentElement.scrollTop;a>g-CLIENT_H&&d.data.httpBo&&d.data.nowLen<d.data.length&&(d.data.httpBo=!1,d.fnHttp(d.data.nowLen))})};d.$watch("data.demos",function(a,b){a!=b&&l()})}}}]),direc.directive("signIn",["ysAnimate",function(a){return{template:'<p>亲，留个信息呗 ^_^</p><div><input type="text" placeholder="昵称" ng-model="msg.nk"></div><div><input type="text" placeholder="QQ号码" ng-model="msg.qq"></div><p>QQ号码仅用作获取头像方便交流之用</p><div><span class="btn" ng-click=fn.confirm()>确定</span><span class="btn" ng-click=fn.hideLogin()>取消</span></div>',link:function(b,c,d){var e=c[0].offsetHeight,f=CLIENT_H/2-e/2;c.css({top:f+"px",opacity:0,display:"none"}),b.$watch("loginBo",function(b,d){b!=d&&(b?(c.find("input").eq(0)[0].focus(),c.css("display","block"),a.move(c,{target:{opacity:1},time:400})):(a.move(c,{target:{opacity:0},time:400}),setTimeout(function(){c.css("display","none")},400)))})}}}]),direc.directive("dialog",["$timeout","ysAnimate",function(a,b){return{template:'<p bindonce ng-bind-html="msg.dialog | to_trusted"></p>',link:function(c,d,e){d.css({display:"none",opacity:0,top:CLIENT_H/2+"px"}),c.$watch("dialogBo",function(e,f){if(e!=f&&e){var g=d[0].offsetHeight;d.css({display:"block",marginTop:-(g/2+50)+"px"}),b.move(d,{target:{opacity:1},time:400});var h=function(){d.css("display","none")};a(function(){b.move(d,{target:{opacity:0},time:400,fn:h})},2600),a(function(){c.dialogBo=!1},3e3)}})}}}]),direc.directive("autoFocus",function(){return{link:function(a,b,c){a.$watch("autoFocus",function(a){a?b[0].focus():b[0].blur()})}}}),direc.directive("ctrlHeight",["$timeout","ysAnimate",function(a,b){return{link:function(c,d,e){c.$watch("ctrlHeightBo",function(e){if(e){var f=d[0].offsetHeight;d.css("height",f+"px"),document.documentElement.scrollTop=document.body.scrollTop=0,b.move(d,{target:{height:0},time:600,fx:"easeOutStrong"}),a(function(){c.getMsg(c.replyPageNum,!0),c.ctrlHeightBo=!1},600)}}),c.$watch("ctrlOpenUlBo",function(e){e&&a(function(){for(var e=d.find("li"),f=e.length,g=50*(f-1)+30,h=0;f>h;h++)g+=e[h].offsetHeight;b.move(d,{target:{height:g},time:600,fx:"easeInStrong"}),a(function(){c.ctrlOpenUlBo=!1},600)},100)})}}}]),direc.directive("opacityBox",["ysAnimate",function(a){return{link:function(b,c,d){c.css("opacity",1),b.$watch("data.opacitBo",function(b,d){return b?a.move(c,{target:{opacity:0},time:400}):void a.move(c,{target:{opacity:1},time:400})})}}}]),direc.directive("getCommentTop",function(){return{link:function(a,b,c){var d=b.find("textarea");a.$watch("startBo",function(c){c&&setTimeout(function(){a.data.texareaT=b[0].offsetTop-50},50)}),a.$watch("data.autoFocus",function(a){a&&d[0].focus()})}}}),direc.directive("openHref",function(){return{link:function(a,b,c){a.$watch("startBo",function(a){a&&setTimeout(function(){var a=b.find("a");a.attr("target","_blank")},50)})}}}),direc.directive("siteSummary",["$window","ysAnimate",function(a,b){return{link:function(c,d,e){var f=d.find("p"),g=800;f.eq(0).css({"-webkit-transform":"translate("+-g+"px, 0px)","-moz-transform":"translate("+-g+"px, 0px)","-ms-transform":"translate("+-g+"px, 0px)","-o-transform":"translate("+-g+"px, 0px)",transform:"translate("+-g+"px, 0px)",opacity:0}),f.eq(1).css({"-webkit-transform":"translate("+g+"px, 0px)","-moz-transform":"translate("+g+"px, 0px)","-ms-transform":"translate("+g+"px, 0px)","-o-transform":"translate("+g+"px, 0px)",transform:"translate("+g+"px, 0px)",opacity:0}),f.eq(2).css("opacity",0);var h=d[0].offsetTop+d[0].offsetHeight,i=600,j=!0;angular.element(a).bind("scroll",function(){var a=this.document.body.scrollTop||this.document.documentElement.scrollTop;a+CLIENT_H-100>h&&j&&(j=!1,b.move(f.eq(0),{target:{opacity:1},time:i}),b.transform(f.eq(0),{target:{translate:[0,0]},time:i+400,fx:"backOut"}),b.move(f.eq(1),{target:{opacity:1},time:i}),b.transform(f.eq(1),{target:{translate:[0,0]},time:i+400,fx:"backOut"}),setTimeout(function(){b.move(f.eq(2),{target:{opacity:1},time:i})},i+400))})}}}]),function(){for(var a=["webkit","moz"],b=0;b<a.length&&!window.requestAnimationFrame;b++)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"]}();var CLIENT_W=document.documentElement.clientWidth,CLIENT_H=document.documentElement.clientHeight,app=angular.module("app",["ui.router","myService","myFilter","myDirective","myController"]);app.run(["$rootScope",function(a){a.pagename="",a.oldPage="",a.articleID="",a.loadingBo=!1,a.time=1e3,a.dialogMsg="",a.dialogShow=!1}]),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/").when("","/");var c='<div id="demo" page class="page"><div class="pubul-wrap" pubuliu><section></section><section></section><section></section></div></div>';a.state("index",{url:"/",templateUrl:"views/index.html"}).state("note-list",{url:"/note-list",templateUrl:"views/note-list.html",controller:"ctrl-note-list"}).state("note",{url:"/note/:id",templateUrl:"views/note.html",controller:"ctrl-note"}).state("demo",{url:"/demo",template:c,controller:"ctrl-demo"}).state("message",{url:"/message",templateUrl:"views/message.html",controller:"ctrl-message"}).state("about",{url:"/about",templateUrl:"views/about.html",controller:"ctrl-about"})}]);